<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>RenÃ©â€™s Telraam</title>

<!-- Voorkomt iOS-inzoom zoveel mogelijk + houdt layout stabiel -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<link rel="icon" href="logo.png">

<link rel="manifest" href='data:application/json,{
  "name":"RenÃ©â€™s Telraam",
  "short_name":"Telraam",
  "start_url":".",
  "display":"standalone",
  "background_color":"#121212",
  "theme_color":"#d32f2f",
  "icons":[
    {"src":"logo.png","sizes":"192x192","type":"image/png"},
    {"src":"logo.png","sizes":"512x512","type":"image/png"}
  ]
}'>

<style>
:root{
  --bg:#f2f2f2; --card:#fff; --text:#000; --accent:#d32f2f;

  --wij:#cfe9ff;      /* lichtblauw */
  --wijRoem:#a9d4ff;  /* iets donkerder */
  --zij:#d6f7d6;      /* lichtgroen */
  --zijRoem:#b8efb8;  /* iets donkerder */
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#121212; --card:#1e1e1e; --text:#fff;
    /* iets â€œdieperâ€ in dark mode maar nog steeds duidelijk */
    --wij:#2a4b63;
    --wijRoem:#1f3c52;
    --zij:#2a5a3a;
    --zijRoem:#224b31;
  }
}

*{box-sizing:border-box;}
body{
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  margin:0;
  padding:10px;
}

.logo{
  display:block;
  margin:10px auto 10px;
  max-width:180px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:12px;
  margin-bottom:10px;
  box-shadow:0 2px 8px rgba(0,0,0,.18);
}

table{width:100%; border-collapse:collapse;}
th,td{padding:6px; text-align:center; vertical-align:middle;}

.smallNote{
  font-size:12px;
  opacity:.8;
}

input{
  /* Belangrijk: >=16px om iOS zoom te voorkomen */
  font-size:16px;
  width:52px;                 /* smaller */
  padding:8px 10px;
  text-align:center;
  border-radius:999px;        /* extra rond */
  border:1px solid rgba(0,0,0,.25);
  outline:none;
}

@media (prefers-color-scheme: dark){
  input{ border:1px solid rgba(255,255,255,.18); }
}

input:focus{
  box-shadow:0 0 0 3px rgba(211,47,47,.25);
}

.inp-wij{ background:var(--wij); }
.inp-wijroem{ background:var(--wijRoem); }
.inp-zij{ background:var(--zij); }
.inp-zijroem{ background:var(--zijRoem); }

button{
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:12px;
  border:none;
  background:var(--accent);
  color:#fff;
  margin-top:6px;
}

#installBtn{display:none;}

#scoreCenter{
  text-align:center;
  font-weight:700;
  margin:10px 0 6px;
}
#scoreCenter .line1{ font-size:18px; }
#scoreCenter .line2{ font-size:18px; margin-top:4px; }

#winner{
  font-size:36px;
  text-align:center;
  color:gold;
  margin:10px 0;
}

#history div{
  padding:6px 4px;
  border-bottom:1px solid rgba(127,127,127,.35);
}

canvas{
  position:fixed;
  top:0; left:0;
  pointer-events:none;
}

/* Splashscreen */
#splash{
  position:fixed;
  inset:0;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:9999;
}
#splash img{ width:180px; }
#splash h2{ margin:10px 0 0; color:var(--accent); }
</style>
</head>

<body>

<div id="splash">
  <img src="logo.png" alt="RenÃ©â€™s Telraam">
  <h2>RenÃ©â€™s Telraam</h2>
</div>

<img src="logo.png" class="logo" alt="RenÃ©â€™s Telraam">

<button id="installBtn">ðŸ“² Installeer app</button>

<div class="card">
  <b>Team Wij</b><br>
  <input id="w1" placeholder="Speler 1" autocomplete="off">
  <input id="w2" placeholder="Speler 2" autocomplete="off"><br><br>
  <b>Team Zij</b><br>
  <input id="z1" placeholder="Speler 1" autocomplete="off">
  <input id="z2" placeholder="Speler 2" autocomplete="off">
  <div class="smallNote" style="margin-top:8px;">
    Punten: typ een getal, of <b>n / p</b> (hoofdletters mag ook).
  </div>
</div>

<div class="card">
  <table>
    <thead>
      <tr>
        <th>R</th>
        <th id="tWij">Wij</th>
        <th>Roem</th>
        <th id="tZij">Zij</th>
        <th>Roem</th>
      </tr>
    </thead>
    <tbody id="rows"></tbody>
    <tfoot>
      <tr>
        <th>Punten</th>
        <th id="puntenWij">0</th>
        <th></th>
        <th id="puntenZij">0</th>
        <th></th>
      </tr>
      <tr>
        <th>Roem</th>
        <th id="roemWij">0</th>
        <th></th>
        <th id="roemZij">0</th>
        <th></th>
      </tr>
      <tr>
        <th>Totaal</th>
        <th id="totalWij">0</th>
        <th></th>
        <th id="totalZij">0</th>
        <th></th>
      </tr>
    </tfoot>
  </table>
</div>

<div id="scoreCenter">
  <div class="line1" id="namesLine">Wij - Zij</div>
  <div class="line2" id="pointsLine">0 - 0</div>
</div>

<div id="winner"></div>

<button onclick="nieuwPotje()">Nieuw potje</button>

<div class="card">
  <h3 style="margin:0 0 8px;">Historie</h3>
  <div id="history"></div>
</div>

<canvas id="confetti"></canvas>

<script>
/* ---------------- Splash ---------------- */
setTimeout(() => (document.getElementById("splash").style.display = "none"), 1200);

/* ---------------- Install button (PWA prompt) ---------------- */
let deferredPrompt;
const installBtn = document.getElementById("installBtn");
window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = "block";
});
installBtn.onclick = () => deferredPrompt && deferredPrompt.prompt();

/* ---------------- App logic ---------------- */
const TOTAL = 162, ROUNDS = 16;
const rows = document.getElementById("rows");

for (let i = 1; i <= ROUNDS; i++) {
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${i}</td>
    <td><input class="inp-wij" data-t="w" data-r="${i}" inputmode="text" autocapitalize="off" spellcheck="false"></td>
    <td><input class="inp-wijroem" data-t="rw" data-r="${i}" inputmode="numeric" autocapitalize="off" spellcheck="false"></td>
    <td><input class="inp-zij" data-t="z" data-r="${i}" inputmode="text" autocapitalize="off" spellcheck="false"></td>
    <td><input class="inp-zijroem" data-t="rz" data-r="${i}" inputmode="numeric" autocapitalize="off" spellcheck="false"></td>
  `;
  rows.appendChild(tr);
}

/* Enter = toetsenbord weg (blur) */
document.querySelectorAll("input").forEach(inp => {
  inp.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      inp.blur();
      window.scrollTo({ top: window.scrollY, behavior: "smooth" });
    }
  });
});

const inputsScore = document.querySelectorAll('input[data-t]');
inputsScore.forEach(inp => inp.addEventListener("input", onScoreInput));

[w1,w2,z1,z2].forEach(i => i.addEventListener("input", () => {
  updateNames();
  save();
}));

function teamWijNaam(){
  const a = (w1.value || "Wij").trim();
  const b = (w2.value || "").trim();
  return b ? `${a} & ${b}` : a;
}
function teamZijNaam(){
  const a = (z1.value || "Zij").trim();
  const b = (z2.value || "").trim();
  return b ? `${a} & ${b}` : a;
}
function updateNames(){
  tWij.textContent = teamWijNaam();
  tZij.textContent = teamZijNaam();
  document.getElementById("namesLine").textContent = `${teamWijNaam()} - ${teamZijNaam()}`;
}

function q(t,r){
  return document.querySelector(`[data-t="${t}"][data-r="${r}"]`);
}

let suppress = false;            // voorkomt â€œloopâ€ bij automatisch bijwerken
let lastWinnerKey = null;        // voorkomt confetti spam

function normalizeSpecial(v){
  const s = (v || "").trim();
  if (!s) return "";
  if (["n","N","p","P"].includes(s)) return s.toLowerCase(); // n of p
  return s;
}

function onScoreInput(e){
  if (suppress) return;

  const el = e.target;
  const t = el.dataset.t;
  const r = parseInt(el.dataset.r, 10);

  // Alleen puntenvelden triggeren het automatisch aanvullen
  if (t !== "w" && t !== "z") {
    updateTotalsAndUI();
    save();
    return;
  }

  const val = normalizeSpecial(el.value);

  const otherT = (t === "w") ? "z" : "w";
  const otherEl = q(otherT, r);

  suppress = true;

  if (val === "") {
    // leeg => tegenover ook leeg (alleen als die door ons ingevuld was)
    // we zetten hem gewoon leeg zodat het consistent blijft
    otherEl.value = "";
  } else if (val === "n" || val === "p") {
    // nat/pit: andere krijgt 162, deze 0
    el.value = "0";
    otherEl.value = String(TOTAL);
  } else if (!isNaN(val)) {
    const num = Math.max(0, Math.min(TOTAL, parseInt(val, 10)));
    el.value = String(num);
    otherEl.value = String(TOTAL - num);
  } else {
    // ongeldige input => laat staan, maar probeer tegenover leeg te maken
    otherEl.value = "";
  }

  suppress = false;

  updateTotalsAndUI();
  save();
}

function updateTotalsAndUI(){
  let tw=0, tz=0, rw=0, rz=0;
  let ingevuld = true;

  for (let i=1; i<=ROUNDS; i++){
    const w = q("w",i).value.trim();
    const z = q("z",i).value.trim();

    // â€œingevuldâ€ betekent: in elke ronde is er een geldige (numerieke) stand aan beide kanten
    // Door onze auto-aanvulling is dat normaal gelijk; maar als iemand iets raars typt, wordt het â€œniet ingevuldâ€
    if (w === "" || z === "" || isNaN(w) || isNaN(z)) ingevuld = false;

    tw += parseInt(w,10) || 0;
    tz += parseInt(z,10) || 0;

    rw += parseInt(q("rw",i).value,10) || 0;
    rz += parseInt(q("rz",i).value,10) || 0;
  }

  const totaalWij = tw + rw;
  const totaalZij = tz + rz;

  puntenWij.textContent = tw;
  puntenZij.textContent = tz;
  roemWij.textContent = rw;
  roemZij.textContent = rz;
  totalWij.textContent = totaalWij;
  totalZij.textContent = totaalZij;

  document.getElementById("pointsLine").textContent = `${tw} - ${tz}`;

  // winnaar pas bij alle 16 rondes â€œnetjesâ€ ingevuld
  if (ingevuld) showWinnerOnce(totaalWij, totaalZij);
  else {
    winner.textContent = "";
    lastWinnerKey = null; // als ze nog bezig zijn, later opnieuw kunnen tonen
  }
}

function showWinnerOnce(w, z){
  const name = (w > z) ? teamWijNaam() : teamZijNaam();
  const key = `${w}|${z}|${name}`;

  winner.textContent = `ðŸ† Winnaar: ${name} ðŸ†`;

  if (lastWinnerKey !== key) {
    lastWinnerKey = key;
    confetti();
  }
}

function save(){
  const d = { w1:w1.value, w2:w2.value, z1:z1.value, z2:z2.value, lastWinnerKey };
  inputsScore.forEach(i => d[i.dataset.t + i.dataset.r] = i.value);
  localStorage.setItem("game", JSON.stringify(d));
}

function load(){
  const d = JSON.parse(localStorage.getItem("game") || "{}");
  w1.value = d.w1 || "";
  w2.value = d.w2 || "";
  z1.value = d.z1 || "";
  z2.value = d.z2 || "";
  lastWinnerKey = d.lastWinnerKey || null;

  inputsScore.forEach(i => {
    const k = i.dataset.t + i.dataset.r;
    if (d[k] !== undefined) i.value = d[k];
  });

  updateNames();
  updateTotalsAndUI();
  loadHistory();
}

function nieuwPotje(){
  if (winner.textContent) {
    const hist = JSON.parse(localStorage.getItem("history") || "[]");
    hist.unshift(winner.textContent);
    localStorage.setItem("history", JSON.stringify(hist));
  }
  localStorage.removeItem("game");
  location.reload();
}

function loadHistory(){
  const hist = JSON.parse(localStorage.getItem("history") || "[]");
  history.innerHTML = "";
  hist.forEach(h => {
    const div = document.createElement("div");
    div.textContent = h;
    history.appendChild(div);
  });
}

function confetti(){
  const c = document.getElementById("confetti");
  const ctx = c.getContext("2d");
  c.width = innerWidth;
  c.height = innerHeight;

  const p = Array.from({length: 220}, () => ({
    x: Math.random() * c.width,
    y: Math.random() * c.height,
    r: Math.random() * 6 + 2,
    vy: Math.random() * 2 + 2
  }));

  const t = setInterval(() => {
    ctx.clearRect(0,0,c.width,c.height);
    p.forEach(o => {
      ctx.beginPath();
      ctx.arc(o.x,o.y,o.r,0,Math.PI*2);
      ctx.fillStyle = `hsl(${Math.random()*360},100%,50%)`;
      ctx.fill();
      o.y += o.vy;
      if (o.y > c.height) o.y = 0;
    });
  }, 30);

  setTimeout(() => clearInterval(t), 3500);
}

load();
</script>
</body>
</html>
